<div class="history-container">
  <div class="header">
    <h1>Trading History</h1>
    <button class="refresh-btn" (click)="refresh()" [disabled]="loading">
      {{ loading ? 'Loading...' : 'Refresh' }}
    </button>
  </div>

  <div class="filter-section">
    <div class="filter-group">
      <input
        type="text"
        [(ngModel)]="symbolFilter"
        placeholder="Filter by symbol (e.g., EURUSD)"
        class="filter-input"
        (keyup.enter)="filterBySymbol()"
      />
      <button class="filter-btn" (click)="filterBySymbol()">Filter</button>
      <button class="clear-btn" (click)="clearFilter()">Clear</button>
    </div>
  </div>

  <div class="summary-cards">
    <div class="summary-card">
      <div class="summary-label">Total Deals</div>
      <div class="summary-value">{{ filteredDeals.length }}</div>
    </div>
    <div class="summary-card">
      <div class="summary-label">Total Profit</div>
      <div class="summary-value" [class.positive]="getTotalProfit() >= 0" [class.negative]="getTotalProfit() < 0">
        {{ getTotalProfit() | number:'1.2-2' }}
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-label">Total Commission</div>
      <div class="summary-value">{{ getTotalCommission() | number:'1.2-2' }}</div>
    </div>
    <div class="summary-card">
      <div class="summary-label">Net Profit</div>
      <div class="summary-value" [class.positive]="getNetProfit() >= 0" [class.negative]="getNetProfit() < 0">
        {{ getNetProfit() | number:'1.2-2' }}
      </div>
    </div>
  </div>

  <div class="deals-table-container">
    <table class="deals-table" *ngIf="filteredDeals.length > 0">
      <thead>
        <tr>
          <th>Ticket</th>
          <th>Time</th>
          <th>Type</th>
          <th>Symbol</th>
          <th>Volume</th>
          <th>Price</th>
          <th>Profit</th>
          <th>Commission</th>
          <th>Swap</th>
          <th>Comment</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let deal of filteredDeals">
          <td>{{ deal.ticket }}</td>
          <td class="date-cell">{{ formatDate(deal.time) }}</td>
          <td>
            <span class="deal-type" [ngClass]="getDealTypeClass(deal.type)">
              {{ getDealType(deal.type) }}
            </span>
          </td>
          <td class="symbol-cell">{{ deal.symbol }}</td>
          <td>{{ deal.volume | number:'1.2-2' }}</td>
          <td>{{ deal.price | number:'1.5-5' }}</td>
          <td [class.positive]="deal.profit >= 0" [class.negative]="deal.profit < 0">
            {{ deal.profit | number:'1.2-2' }}
          </td>
          <td>{{ deal.commission | number:'1.2-2' }}</td>
          <td>{{ deal.swap | number:'1.2-2' }}</td>
          <td class="comment-cell">{{ deal.comment || '-' }}</td>
        </tr>
      </tbody>
    </table>

    <div class="no-data" *ngIf="filteredDeals.length === 0 && !loading">
      No deals found
    </div>

    <div class="loading-spinner" *ngIf="loading">
      Loading deals history...
    </div>
  </div>
</div>
