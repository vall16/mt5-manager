<div class="user-dashboard">
  <div class="dashboard-header">
    <div class="user-info">
      <div class="user-avatar">
        {{ (authService.currentUserValue?.username || '?').charAt(0).toUpperCase() }}
      </div>
      <div class="user-details">
        <h2>Welcome, {{ authService.currentUserValue?.username }}</h2>
        <p class="user-email">Manage your MT5 trading accounts</p>
      </div>
    </div>
    <button class="logout-button" (click)="logout()">
      <span>Logout</span>
    </button>
  </div>

  <div class="traders-section">
    <div class="section-header">
      <h3>My Traders</h3>
      
      <div class="header-buttons">
        <button class="add-server-btn" (click)="openServersList()">
        <!-- <button class="add-server-btn" (click)="openAddServerModal()"> -->
          <span class="plus-icon">+</span>
          <span>Add Server</span>
        </button>
        <button class="add-trader-btn" (click)="openAddModal()">
          <span class="plus-icon">+</span>
          <span>Add Trader</span>
        </button>
      </div>

    </div>

    <div class="traders-grid">
      <div class="trader-card" *ngFor="let trader of traders">
        <div class="card-header">
          <div class="trader-info">
            <h4>{{ trader.name }}</h4>
            <span class="trader-status" [class.active]="trader.status === 'active'" [class.inactive]="trader.status === 'inactive'">
              {{ trader.status }}
            </span>
          </div>
          
        </div>

    <div class="card-body">
      <div class="detail-row">
      <span class="label">Master Server:</span>
    
      <select *ngIf="servers?.length" [(ngModel)]="trader.master_server_id">
        <option *ngFor="let server of servers" [ngValue]="server.id">{{ server.server }}</option>
      </select>


      </div>
      <div class="detail-row">
        <span class="label">Slave Server:</span>
      
        <select [(ngModel)]="trader.slave_server_id">
          <option *ngFor="let server of servers" [ngValue]="server.id">
            {{ server.server }}
          </option>
        </select>
      </div>
      <!-- Trading parameters -->
      <div class="detail-row">
        <span class="label">SL:</span>
        <span class="value">{{ trader.sl }}</span>
      </div>
      <div class="detail-row">
        <span class="label">TP:</span>
        <span class="value">{{ trader.tp }}</span>
      </div>
      <div class="detail-row">
        <span class="label">TSL:</span>
        <span class="value">{{ trader.tsl }}</span>
      </div>
      <div class="detail-row">
        <span class="label">Multiplier:</span>
        <span class="value">{{ trader.moltiplicatore }}</span>
      </div>
      <div class="detail-row" *ngIf="trader.fix_lot">
        <span class="label">Fixed Lot:</span>
        <span class="value">{{ trader.fix_lot }}</span>
      </div>
      <div class="detail-row">
        <span class="label">Created:</span>
        <span class="value">{{ trader.created_at | date:'short' }}</span>
      </div>
      </div>
      <div class="card-actions">
          <button class="action-btn primary" (click)="goToMT5Dashboard(trader)">
            Open Dashboard
          </button>
          <button class="action-btn secondary" (click)="toggleTraderStatus(trader)">
            {{ trader.status === 'active' ? 'Deactivate' : 'Activate' }}
          </button>
        </div>
      </div>
      <!-- Nuova Card per aggiungere un trader -->
  <div class="trader-card add-trader-card">
    <div class="card-header">
      <h4>Add New Trader</h4>
    </div>

    <div class="card-body">
      <div class="detail-row">
        <span class="label">Name:</span>
        <input type="text" [(ngModel)]="newTrader.name" placeholder="Trader Name" />
      </div>
      <div class="detail-row">
        <span class="label">Master Server:</span>
        <select [(ngModel)]="newTrader.master_server_id">
          <option *ngFor="let server of servers" [value]="server.id">{{ server.server }}</option>
        </select>
      </div>
      <div class="detail-row">
        <span class="label">Slave Server:</span>
        <select [(ngModel)]="newTrader.slave_server_id">
          <option *ngFor="let server of servers" [value]="server.id">{{ server.server }}</option>
        </select>
      </div>
      <div class="detail-row">
        <span class="label">SL:</span>
        <input type="number" [(ngModel)]="newTrader.sl" placeholder="Stop Loss" />
      </div>
      <div class="detail-row">
        <span class="label">TP:</span>
        <input type="number" [(ngModel)]="newTrader.tp" placeholder="Take Profit" />
      </div>
      <div class="detail-row">
        <span class="label">TSL:</span>
        <input type="number" [(ngModel)]="newTrader.tsl" placeholder="Trailing SL" />
      </div>
      <div class="detail-row">
        <span class="label">Multiplier:</span>
        <input type="number" [(ngModel)]="newTrader.moltiplicatore" placeholder="Multiplier" />
      </div>
      <div class="detail-row">
        <span class="label">Fixed Lot:</span>
        <input type="number" [(ngModel)]="newTrader.fix_lot" placeholder="Optional" />
      </div>
    </div>

    <div class="card-actions">
      <button class="action-btn primary" (click)="addTrader()">Add Trader</button>
    </div>
  </div>



      <div class="empty-state" *ngIf="traders.length === 0">
        <div class="empty-icon">ðŸ“Š</div>
        <h3>No traders yet</h3>
        <p>Click the "Add Trader" button to create your first MT5 trading account</p>
      </div>
    </div>

  </div>
</div>

<div class="modal-overlay" *ngIf="showAddModal" (click)="closeAddModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <!-- <app-add-trader-modal (traderAdded)="onTraderAdded()" (cancel)="closeAddModal()"></app-add-trader-modal> -->
    <app-add-trader-modal></app-add-trader-modal>
  </div>
</div>
<div class="modal-overlay" *ngIf="showServersList" (click)="closeServersList()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <!-- <app-servers-list (traderAdded)="onTraderAdded()" (cancel)="closeAddModal()"></app-servers-list> -->
     <app-servers-list></app-servers-list>
  </div>
</div>
